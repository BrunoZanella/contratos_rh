{% extends 'base.html' %}

{% block title %}{% if is_new %}Novo Setor{% else %}Editar Setor{% endif %}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6 max-w-2xl">
    <div class="mb-6">
        <a href="{% url 'admin_dashboard' %}" class="text-indigo-600 hover:text-indigo-800 flex items-center mb-4 text-sm">
            <i class="fas fa-arrow-left mr-2"></i> Voltar ao painel de administração
        </a>
        
        <h1 class="text-2xl md:text-3xl font-bold text-gray-900 flex items-center">
            <i class="fas fa-{% if is_new %}plus-circle text-green-600{% else %}edit text-indigo-600{% endif %} mr-3"></i>
            {% if is_new %}Novo Setor{% else %}Editar Setor{% endif %}
        </h1>
        <p class="text-gray-600 mt-1">{% if is_new %}Cadastre um novo setor no sistema{% else %}Atualize as informações do setor{% endif %}</p>
    </div>

    <div class="bg-white rounded-lg shadow-md overflow-hidden">
        <div class="p-5 border-b border-gray-200 bg-gray-50">
            <h2 class="text-lg font-semibold text-gray-900">
                {% if is_new %}Informações do Novo Setor{% else %}Informações do Setor{% endif %}
            </h2>
        </div>
        
        <form method="post" class="p-6">
            {% csrf_token %}
            
            <div class="space-y-6">
                <div>
                    <label for="{{ form.nome.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                        Nome do Setor <span class="text-red-500">*</span>
                    </label>
                    <div class="relative rounded-md shadow-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-building text-gray-400"></i>
                        </div>
                        <div class="pl-10">
                            {{ form.nome }}
                        </div>
                    </div>
                    {% if form.nome.errors %}
                    <p class="mt-2 text-sm text-red-600">{{ form.nome.errors.0 }}</p>
                    {% else %}
                    <p class="mt-1 text-xs text-gray-500">Digite um nome descritivo para o setor</p>
                    {% endif %}
                </div>
                
                <div id="acesso-completo-container" class="bg-gray-50 p-4 rounded-lg transition-colors duration-300 {% if form.acesso_completo.value %}bg-green-50 border border-green-200{% endif %}">
                    <div class="flex items-start">
                        <div class="flex items-center h-5">
                            {{ form.acesso_completo }}
                        </div>
                        <div class="ml-3 text-sm">
                            <label for="{{ form.acesso_completo.id_for_label }}" class="font-medium text-gray-700">
                                Acesso Completo
                            </label>
                            <p class="text-gray-500">
                                Se marcado, usuários deste setor terão acesso ao dashboard, estatísticas e todos os candidatos
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="text-sm font-medium text-gray-700 mb-2">Permissões do Setor</h3>
                    <ul class="space-y-2 text-sm text-gray-600">
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mt-0.5 mr-2"></i>
                            <span>Visualizar candidatos associados ao setor</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mt-0.5 mr-2"></i>
                            <span>Gerenciar documentos dos candidatos</span>
                        </li>
                        <li class="flex items-start">
                            <i id="permissao-dashboard" class="fas {% if form.acesso_completo.value %}fa-check-circle text-green-500{% else %}fa-times-circle text-red-500{% endif %} mt-0.5 mr-2 transition-colors duration-300"></i>
                            <span>Visualizar dashboard e estatísticas</span>
                        </li>
                        <li class="flex items-start">
                            <i id="permissao-candidatos" class="fas {% if form.acesso_completo.value %}fa-check-circle text-green-500{% else %}fa-times-circle text-red-500{% endif %} mt-0.5 mr-2 transition-colors duration-300"></i>
                            <span>Acessar todos os candidatos do sistema</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="flex justify-end gap-3 mt-8">
                <a href="{% url 'admin_dashboard' %}" class="btn btn-secondary flex items-center">
                    <i class="fas fa-times mr-2"></i>Cancelar
                </a>
                <button type="submit" class="btn btn-primary flex items-center">
                    <i class="fas fa-{% if is_new %}plus{% else %}save{% endif %} mr-2"></i>
                    {% if is_new %}Criar Setor{% else %}Salvar Alterações{% endif %}
                </button>
            </div>
        </form>
    </div>
    
    {% if not is_new %}
    <div class="mt-6 bg-white rounded-lg shadow-md overflow-hidden">
        <div class="p-5 border-b border-gray-200 bg-gray-50">
            <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                <i class="fas fa-users text-indigo-600 mr-2"></i>
                Usuários neste Setor
            </h2>
        </div>
        
        <div class="p-6">
            {% if setor.usuarios.all %}
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                {% for perfil in setor.usuarios.all %}
                <div class="flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50">
                    <!-- <div class="flex-shrink-0 h-12 w-12 bg-indigo-100 rounded-full flex items-center justify-center">
                        <span class="text-indigo-600 font-medium text-lg">{{ perfil.usuario.first_name|slice:":1"|upper }}{{ perfil.usuario.last_name|slice:":1"|upper }}</span>
                    </div> -->
                    <div class="ml-4 flex-1">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-sm font-medium text-gray-900">
                                    {% if perfil.usuario.first_name or perfil.usuario.last_name %}
                                        {{ perfil.usuario.first_name }} {{ perfil.usuario.last_name }}
                                    {% else %}
                                        {{ perfil.usuario.username }}
                                    {% endif %}
                                </div>
                                <div class="text-xs text-gray-500">{{ perfil.usuario.email }}</div>
                            </div>
                            <div class="flex items-center">
                                {% if perfil.usuario.is_staff %}
                                <span class="px-2 py-1 text-xs rounded-full bg-purple-100 text-purple-800 mr-2">
                                    <i class="fas fa-shield-alt mr-1"></i> Admin
                                </span>
                                {% endif %}
                                <span class="px-2 py-1 text-xs rounded-full {% if perfil.usuario.is_active %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %}">
                                    <i class="fas {% if perfil.usuario.is_active %}fa-check{% else %}fa-times{% endif %} mr-1"></i>
                                    {{ perfil.usuario.is_active|yesno:"Ativo,Inativo" }}
                                </span>
                            </div>
                        </div>
                        <div class="mt-1 flex items-center text-xs text-gray-500">
                            <i class="fas fa-calendar-alt mr-1"></i>
                            Cadastrado em {{ perfil.data_criacao|date:"d/m/Y" }}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="flex flex-col items-center py-6 text-gray-500">
                <i class="fas fa-users text-gray-400 text-4xl mb-3"></i>
                <p>Nenhum usuário associado a este setor</p>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const acessoCompletoCheckbox = document.getElementById('{{ form.acesso_completo.id_for_label }}');
        const permissaoDashboard = document.getElementById('permissao-dashboard');
        const permissaoCandidatos = document.getElementById('permissao-candidatos');
        const acessoCompletoContainer = document.getElementById('acesso-completo-container');
        
        // Função para atualizar os ícones de permissão
        function atualizarPermissoes() {
            if (acessoCompletoCheckbox.checked) {
                permissaoDashboard.className = 'fas fa-check-circle text-green-500 mt-0.5 mr-2 transition-colors duration-300';
                permissaoCandidatos.className = 'fas fa-check-circle text-green-500 mt-0.5 mr-2 transition-colors duration-300';
                acessoCompletoContainer.classList.add('bg-green-50', 'border', 'border-green-200');
                acessoCompletoContainer.classList.remove('bg-gray-50');
            } else {
                permissaoDashboard.className = 'fas fa-times-circle text-red-500 mt-0.5 mr-2 transition-colors duration-300';
                permissaoCandidatos.className = 'fas fa-times-circle text-red-500 mt-0.5 mr-2 transition-colors duration-300';
                acessoCompletoContainer.classList.remove('bg-green-50', 'border', 'border-green-200');
                acessoCompletoContainer.classList.add('bg-gray-50');
            }
        }
        
        // Adicionar evento de mudança ao checkbox
        acessoCompletoCheckbox.addEventListener('change', atualizarPermissoes);
        
        // Inicializar o estado
        atualizarPermissoes();
    });
</script>
{% endblock %}
